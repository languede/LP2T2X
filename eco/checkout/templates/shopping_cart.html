<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title></title>

    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link rel="stylesheet" type="text/css" href="/static/checkout/shopping_cart.css"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>
<main class="box">
    <aside class="one">
        <figure class="user">
            <img src="/media/checkout/logo.png" alt="">
            <p>ECO REWARDS</p>
        </figure>
        <div class="title">
            <p>Scanning</p>
            <p>Items</p>
        </div>
        <label>
            <input type="text" id="id_barcode" class="barcode" placeholder="Enter item barcode">
        </label>
        <button name="submit" class="barcode" value="START" onclick="">Add</button>
        {% if user.username %}
            <article class="welcome">
                <p id="username">{{ user.username }}</p>
                <p id="point">My point: {{ user.green_point }}</p>
            </article>
            <button id="id_logout" class="home_button" name="submit" value="HOME"
                    onclick="location.href = {% url "start_page" %}">LOG OUT
            </button>
        {% else %}
            <form action="{% url 'start_page' %}" method="POST" enctype=multipart/form-data> {% csrf_token %}
                {% for field in register_form %}
                    {{ field }}
                {% endfor %}
                <button name="submit" class="phone" value="START">START</button>
            </form>
            <button id="id_home" class="home_button" name="submit" value="HOME"
                    onclick="location.href = {% url "start_page" %}">BACK TO HOME
            </button>
        {% endif %}
    </aside>
    <div class="two">
        <div class="h">
            <p id="id_your_cart">Your Cart</p>
            <img src="/media/checkout/cart2.jpg" alt="cart">
        </div>
        <div class="c">
            <div class="kong">
{#            {% if flag %}#}
{#                <img src="/media/checkout/y4.png" alt="cart2">#}
{#                <p>Oops! Your Cart is empty</p>#}
{#            {% else %}#}
                <menu id="id_item"></menu>
{#            {% endif %}#}
            </div>
        </div>
        <div class="f">
            <div class="total-price">
                <p id="id_total">Total:</p>
                <p id="id_total_price">$ 70.00</p>
            </div>
            <div class="r">
                <button type="button"><span class="finish">FINISH</span></button>
            </div>
        </div>
    </div>
</main>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
</body>
{#FIXME: this script does not work after brower finish loaded and rendering webpage#}
{#<script type="text/javascript">#}
{#    document.getElementById("id_logout").onclick = function () {#}
{#        location.href = {% url "start_page" %};#}
{#    }#}
{#    document.getElementById("id_home").onclick = function () {#}
{#        location.href = {% url "start_page" %};#}
{#    }#}
{#</script>#}
<script>
    $(document).ready(function () {
        $.ajax({
            type: 'GET',
            url: "{% url 'get_product' %}",
            success: function (response) {
                const id_item = $("#id_item")
                id_item.empty();
                if (response.product) {
                    let temp = ''
                    for (let key in response.product) {
                        temp += "<ul>";
                        temp += "<img alt='item' src=/media/" + response.product[key].image + ">"
                        temp += "<div id='id_item_number' class='input-group inline-group'>";
                        temp += "<div class='input-group-prepend'>"
                        temp += "<button id='id_minus_button' class='btn btn-outline-secondary btn-minus'><i class='fa fa-minus'></i></button>";
                        temp += "</div>"
                        temp += "<input id='id_item_count' class='form-control quantity' min='0' name='quantity' value='0' type='number'>";
                        temp += "<div class='input-group-append'>";
                        temp += "<button id='id_plus_button' class='btn btn-outline-secondary btn-plus'><i class='fa fa-plus'></i></button>";
                        temp += "</div></div>"
                        temp += "<li><label id='id_item_name'>" + response.product[key].name + "</label></li>";
                        temp += "<li><span id='id_item_price'>$" + response.product[key].price + "</span></li>";
                        temp += "<button id='id_delete_button' class='btn btn-outline-secondary btn-plus'><i class='fa fa-close'></i></button>"
                        temp += "</ul>"
                    }
                    id_item.append(temp);
                    $('.btn-plus, .btn-minus').on('click', function (e) {
                        const isNegative = $(e.target).closest('.btn-minus').is('.btn-minus');
                        const input = $(e.target).closest('.input-group').find('input');
                        if (input.is('input')) {
                            input[0][isNegative ? 'stepDown' : 'stepUp']()
                        }
                    })
                }
            },
            error: function (response) {
                alert("An Error Occurred")
            }
        });
    });
</script>
</html>
